# Dashboard Generator Upgrade Plan

## Objective
Update `dashboard_generator.py` to act as an aggregator, merging raw KPI data with the rich SEO/Analyst content generated by `page_generator.py`. This supports the new "Unified Dashboard" UI with tabbed "Options vs. Fundamentals" content.

## Input Data Sources
1.  **KPI Data:** `prep/{ticker}_{date}.json` (Existing)
    *   Contains: Fundamental scores, technical indicators, raw financial metrics.
2.  **Rich Content:** `pages/{ticker}_page_{date}.json` (From `page_generator.py`)
    *   Contains: `analystBrief` (HTML), `marketStructure` (Gamma Walls), `tradeSetup`, `seo`, and `fullAnalysis`.

## Target Schema (`dashboards/{ticker}_dashboard_{date}.json`)

The output JSON will be restructured to match the TypeScript interface of the frontend.

```json
{
  "ticker": "AAL",
  "runDate": "2026-01-13",
  
  // --- Section 1: Execution Deck Data ---
  "analysis": {
    "summary": {
      "signal": "Bullish",        // Source: page_json.tradeSetup.signal
      "score": 85,                // Source: page_json.bullishScore
      "confidence": "High"        // Source: page_json.tradeSetup.confidence
    },
    
    // --- Section 2: Options Desk Brief (Tab 1) ---
    "optionsBrief": {
      "headline": "Bulls attacking the $125 Call Wall", // Source: page_json.analystBrief.headline
      "content": "<p>...</p>",                          // Source: page_json.analystBrief.content
      "marketStructure": {                              // Source: page_json.marketStructure
         "call_wall": 125.0,
         "put_wall": 115.0,
         "put_call_vol_ratio": 0.65,
         "net_gamma_label": "Positive" // Derived or raw
      }
    },
    
    // --- Section 3: Fundamental Thesis (Tab 2) ---
    "fundamentalThesis": {
      "headline": "Macro & Fundamental Drivers",
      "content": "<p>...</p>",        // Source: page_json.contentBlocks.thesis OR fullAnalysis.news
      "catalysts": ["..."]            // Source: page_json.tradeSetup.catalyst (as array) or contentBlocks.catalysts
    },
    
    // --- Section 4: Trade Plan ---
    "tradeSetup": {                   // Source: page_json.tradeSetup
      "strategy": "Long Calls",
      "catalyst": "Earnings Beat"
    }
  },

  // --- Existing Data (Keep for Charts/Widgets) ---
  "kpis": { ... },
  "priceChartData": { ... },
  
  // --- SEO Metadata (For Head Tags) ---
  "seo": {                           // Source: page_json.seo
    "title": "...",
    "metaDescription": "..."
  }
}
```

## Implementation Logic (`process_prep_file`)

1.  **Read Prep File:** Load the KPI data (standard trigger).
2.  **Locate Page File:** Construct path `pages/{ticker}_page_{run_date}.json`.
3.  **Load Page Data:**
    *   If file exists: Load JSON.
    *   If missing: Log warning, create a "skeleton" `analysis` object with "Analysis Pending" text to prevent UI crash.
4.  **Map Fields:**
    *   `analysis.summary` <= `page_json.tradeSetup` + `page_json.bullishScore`
    *   `analysis.optionsBrief` <= `page_json.analystBrief` + `page_json.marketStructure`
    *   `analysis.fundamentalThesis` <= `page_json.contentBlocks`
5.  **Merge & Save:** Combine with `kpis` and `priceChartData` and write to `dashboards/`.

## Next Steps
1.  Verify `page_generator.py` is successfully outputting the new schema (`analystBrief`, `marketStructure`).
2.  Apply changes to `dashboard_generator.py` following this plan.
